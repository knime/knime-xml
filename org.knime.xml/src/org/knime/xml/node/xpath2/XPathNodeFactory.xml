<?xml version="1.0" encoding="utf-8"?>
<knimeNode type="Manipulator" icon="./xpath.png" xmlns="http://knime.org/node/v4.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://knime.org/node/v4.1 http://knime.org/node/v4.1.xsd">
    <name>XPath</name>
    <shortDescription>Performs XPath queries on a XML column.</shortDescription>
    
    <fullDescription>
        <intro>
            The node takes the XML Documents of the selected column and 
            performs XPath queries on them. The node supports XPath 1.0.
         
		    <h3>XPath Syntax</h3>
		    <h4>Selection Nodes</h4>
		    <table>
		    <tr><th>Expression</th><th>Description</th></tr>
		    <tr><td>nodename</td><td>Selects all nodes with the name &quot;nodename&quot;</td></tr>
		    <tr><td>/</td><td>Selects from the root node.</td></tr>
		    <tr><td>//</td><td>Selects nodes in the document from the current node that match the selection no matter where they are </td></tr>
		  	<tr><td>.</td><td>Selects the current node</td></tr>
		  	<tr><td>..</td><td>Selects the parent of the current node</td></tr>
		 	<tr><td>@</td><td>Selects attributes</td></tr>
			</table>
			
			<h4>Predicates</h4>
			<table>
			<tr><th >Path Expression</th><th>Result</th></tr>
			<tr><td>/bookstore/book[1]</td><td>Selects the first book element that is the child of the bookstore element.</td></tr>
			<tr><td>/bookstore/book[last()]</td><td>Selects the last book element that is the child of the bookstore element</td></tr>
			<tr><td>/bookstore/book[last()-1]</td><td>Selects the last but one book element that is the child of the bookstore element</td></tr>
			<tr><td>/bookstore/book[position()&lt;3]</td><td>Selects the first two book elements that are children of the bookstore element</td></tr>
			<tr><td>//title[@lang]</td><td>Selects all the title elements that have an attribute named lang</td></tr>
			<tr><td>//title[@lang='en']</td><td>Selects all the title elements that have a &quot;lang&quot; attribute with a value of &quot;en&quot;</td></tr>
			<tr><td>/bookstore/book[price&gt;35.00]</td><td>Selects all the book elements of the bookstore element that have a price element with a value greater than 35.00</td></tr>
			<tr><td>/bookstore/book[price&gt;35.00]/title</td><td>Selects all the title elements of the book elements of the bookstore element that have a price element with a value greater than 35.00</td></tr>
			</table>
		
			<p>Syntax description from  <a href="https://www.w3schools.com/xml/xpath_syntax.asp">w3cschools.com</a>.</p>    
            
            <p><b>Hint for streaming:</b> Node can only be executed in real streamed fashion if every single XPath query is configured as follow (see XPath Query Settings):<br></br>
            The column names are fixed (i.e. select 'new column name') and either 'Single Cell', 'Collection Cell', or 'Multiple Rows' are selected as 'Multiple tag option'.</p>
		</intro>
		<tab name="Settings">
	        <option name="XML column">The column containing the XML cells.</option>
	        <option name="Remove source column">
	            Check when the source column should not show up in the output table.
	        </option>
	        <option name="XPath summary">A summary of all defined XPath queries.</option>
	        <option name="Add XPath">Opens a new dialog with the XPath query set XPath query of the selected XML element.
	        </option>
	        <option name="Eidt XPath">Edit a selected XPath query of the summary table.</option>
	        <option name="Remove XPath">Remove a selected XPath query of the summary table.</option>
	        <option name="XML-Cell Preview">Preview of the first not missing XML-Cell of the selected XML column. If a XML 
	        element is selected a right click can be performed to add a new XPath query.<br/>
	        <b>Note:</b> Only the first 2000 lines of the input XML cell are displayed.</option>
        </tab>
        <tab name="Namespace">
	        <option name="Namespaces">
	            The prefixes and the namespaces used in the XPath query. For the
	            example when querying XHTML documents with the XPath Query:<br/>
	            <i>//pre:h1</i><br/> 
	            the following namespace must be defined:
	            <br/>
	            Prefix: <i>pre</i>
	            <br/>
	            Namespace: <i>http://www.w3.org/1999/xhtml</i>   
	            <br/>
	            <b>Note:</b> The namespaces are collected automatically.      
	        </option>
	        <option name="Incorporate namespace of the root element.">
	            <p>This option is useful when you do not have the default
	            namespace of your document at hand.</p>
	        	<p>If checked, the namespace of the root element is added to the 
	        	<b>Namespaces</b> table during runtime. Please define a prefix for this 
	        	namespace in <b>Prefix of root's namespace</b>.</p>
	        	<p>For the example of XHTML documents the namespace of the root 
	        	element is http://www.w3.org/1999/xhtml so that with the
	        	root's prefix of <i>pre</i> you can leave
	        	the <b>Namespaces</b> table empty.</p>     
	        </option>          
        </tab>
    </fullDescription>
    <ports>
        <inPort index="0" name="Input Table">
            Input table containing at least one XML column.
        </inPort>
        <outPort index="0" name="Output Table">
            The input table with additional columns containing the result of the XPath queries.
        </outPort>        
    </ports>
    <keywords>
    	<keyword>xml parse</keyword>
    </keywords>
</knimeNode>
